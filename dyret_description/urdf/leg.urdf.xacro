<?xml version="1.0"?>
<robot xmlns:xacro="http:/ros.org/wiki/xacro">
	<!-- Macro for one leg of Dyret -->
	<xacro:macro name="leg" params="name frev">
		<link name="${name}_coxa">
			<visual>
				<origin xyz="0.036 0 0" />
				<geometry>
					<mesh filename="package://dyret_description/meshes/coxa_assembly.STL" />
				</geometry>
			</visual>
			<collision>
				<origin xyz="0.036 0 0" />
				<geometry>
					<box size="0.072 0.051 0.051" />
				</geometry>
			</collision>
			<inertial>
				<origin xyz="0.036 0 0" />
				<mass value="0.045" />
				<inertia
					ixx="1.95e-05" ixy="0.0" ixz="0.0"
					iyy="2.92e-05" iyz="0.0"
					izz="2.92e-05" />
			</inertial>
		</link>
		<link name="${name}_femur">
			<visual>
				<origin xyz="0.0525 0 0" />
				<geometry>
					<mesh filename="package://dyret_description/meshes/femur_assembly.STL" />
				</geometry>
			</visual>
			<collision>
				<origin xyz="0.0525 0 0" />
				<geometry>
					<box size="0.129 0.0382 0.0503" />
				</geometry>
			</collision>
			<inertial>
				<origin xyz="0.0525 0 0" />
				<mass value="0.3" />
				<inertia
					ixx="9.97e-05" ixy="0.0" ixz="0.0"
					iyy="4.52e-04" iyz="0.0"
					izz="4.79e-04" />
			</inertial>
		</link>
		<joint name="${name}_femur_joint" type="revolute">
			<origin xyz="0.072 0 0" rpy="0 0 ${frev * -1.047}" />
			<parent link="${name}_coxa" />
			<child link="${name}_femur" />
			<!--<dynamics damping="0.01" />-->
			<limit effort="6.0" lower="-1.92" upper="1.92" velocity="2.57" />
			<axis xyz="0 0 1" />
		</joint>
		<transmission name="${name}_femur_transmission">
			<type>transmission_interface/SimpleTransmission</type>
			<actuator name="${name}_femur_motor">
				<hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
				<mechanicalReduction>1</mechanicalReduction>
			</actuator>
			<joint name="${name}_femur_joint">
				<hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
			</joint>
		</transmission>
		<link name="${name}_tibia">
			<visual>
				<geometry>
					<mesh filename="package://dyret_description/meshes/tibia_assembly.STL" />
				</geometry>
			</visual>
			<!-- Collision element for servo bracket -->
			<collision>
				<origin xyz="0.018 0 0 " />
				<geometry>
					<box size="0.036 0.03 0.051" />
				</geometry>
			</collision>
			<!-- Collision element for 3D printed holder -->
			<collision>
				<origin xyz="${0.06 + 0.036} 0 0 " />
				<geometry>
					<box size="0.12 0.03 0.0245" />
				</geometry>
			</collision>
			<!-- Collision element for aluminium arm -->
			<collision>
				<origin xyz="${0.06 + 0.036 + 0.105} -0.0015 0 " />
				<geometry>
					<box size="0.098 0.012 0.012" />
				</geometry>
			</collision>
			<!-- Collision element for rubber sphere -->
			<collision>
				<origin xyz="${0.06 + 0.036 + 0.105 + 0.053} -0.0015 0 " />
				<geometry>
					<sphere radius="0.01" />
				</geometry>
			</collision>
			<inertial>
				<origin xyz="0.15 0 0" />
				<mass value="0.209" />
				<inertia
					ixx="2.61e-05" ixy="0.0" ixz="0.0"
					iyy="9.21e-04" iyz="0.0"
					izz="9.15e-04" />
			</inertial>
		</link>
		<joint name="${name}_tibia_joint" type="revolute">
			<origin xyz="0.1045 0 0" rpy="0 0 ${frev * 1.222}"/>
			<parent link="${name}_femur" />
			<child link="${name}_tibia" />
			<!--<dynamics damping="0.01" />-->
			<limit effort="6.0" lower="-1.92" upper="1.92" velocity="2.57" />
			<axis xyz="0 0 1" />
		</joint>
		<transmission name="${name}_tibia_transmission">
			<type>transmission_interface/SimpleTransmission</type>
			<actuator name="${name}_tibia_motor">
				<hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
				<mechanicalReduction>1</mechanicalReduction>
			</actuator>
			<joint name="${name}_tibia_joint">
				<hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
			</joint>
		</transmission>
		<!-- This enables friction within Gazebo -->
		<gazebo reference="${name}_tibia">
			<mu1 value="200" />
			<mu2 value="200" />
			<!-- Include Contact sensor for feet -->
			<xacro:if value="$(arg contact_enabled)">
				<sensor name="${name}_contact_sensor" type="contact" always_on="true"
					update_rate="10.0">
					<contact>
						<collision name="${name}_tibia_collision_3" />
					</contact>
					<plugin name="${name}_contact_plugin" filename="libgazebo_ros_bumper.so">
						<alwaysOn>true</alwaysOn>
						<updateRate>10.0</updateRate>
						<frameName>world</frameName>
						<bumperTopicName>${name}_contact</bumperTopicName>
					</plugin>
				</sensor>
			</xacro:if>
		</gazebo>
	</xacro:macro>
</robot>
